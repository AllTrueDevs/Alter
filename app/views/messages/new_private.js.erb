<% ids = (@companion.id < @user.id) ? [ @companion.id, @user.id ]  : [ @user.id, @companion.id ] %>
<% publish_to "/messages/private/#{ids[0]}_#{ids[1]}" do %>
    $("<%= escape_javascript(render partial: 'message', locals: { message: @message, companion: @user }) %>").appendTo('.messages');
    $('.messages h5').remove();
<% end %>
$('.message').last().remove();
$("<%= escape_javascript(render partial: 'message', locals: { message: @message, companion: @companion, at_moment: true }) %>").appendTo('.messages');
$('.message-form .fields').each(function() {
    return $(this).remove();
});
$('.message-form .add_nested_fields').prop('disabled', false);