<% ids = (@companion.id < @user.id) ? [ @companion.id, @user.id ]  : [ @user.id, @companion.id ] %>
<% publish_to "/messages/private/#{ids[0]}_#{ids[1]}" do %>
    $('.messages').html("<%= escape_javascript(render 'messages', messages: @messages, companion: @user) %>");
<% end %>
$('.messages').html("<%= escape_javascript(render 'messages', messages: @messages, companion: @companion) %>");
$('#message_body').val('').focus();
$('.message-form .fields').each(function() {
    return $(this).remove();
});
$('.message-form .add_nested_fields').prop('disabled', false);